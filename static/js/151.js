(self.webpackChunkredux_tsc=self.webpackChunkredux_tsc||[]).push([[151],{9151:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>j});var r=a(7294),n=a(6239);const s=a.p+"static/images_icons/d1d68e1d30f5690ce6624162050f15a4.jpg";var i=a(9169);function c(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?o(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var l=[].concat(c(Array(10).fill({id:1,first_name:"My",last_name:"My",picture:s,created_time:"2021-07-10T06:18:00",message:"This is message\nasd asd asd asd asd asda\nasd asd asd asda dsa dasd\nasd asd asda dsa asd ada das daasd asd asdasd asda das ad ad ad as asd asd adadsa ads ad ad adas das das ad adasd"})),c(Array(10).fill({id:2,first_name:"Nguyen",last_name:"Nguyen",picture:s,created_time:"2021-07-10T04:18:00",message:"ad asdsa dad ad\nasd asd asd asd asd asda\nasd asd asd asda dsa dasd\nasd asd asda dsa asd ada das daasd asd asdasd asda das ad ad ad as asd asd adadsa ads ad ad adas das das ad adasd"}))),d=function(e){return new Promise((function(t){setTimeout((function(){t({data:{data:e,count:52}})}),250)}))};function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i.D?d(l):(0,n.Z)({url:"api/chat/message-l/",method:"GET",params:e})}var m=a(5616);function f(e){var t=e.picture;return r.createElement("div",{className:"ChatBdMsLeft"},r.createElement("div",null,r.createElement("img",{className:"brs-50",src:t,alt:"",width:"50",height:"50"})))}function g(e){var t=e.is_user,a=e.first_name,n=e.last_name,s=e.message,i=e.created_time;return r.createElement("div",null,r.createElement("div",null,r.createElement("div",null,r.createElement("div",{className:"ChatBdMsRight_name label-field ".concat(t?"text-align-end margin-left-auto":"")},a," ",n)),r.createElement("div",{className:"ChatBdMsRight_message ".concat(t?"bg-blue":"bg-fb")},r.createElement("div",{className:"ChatBdMsRight_message-text"},s)),r.createElement("div",null,r.createElement("div",{className:"font-12px font-italic ".concat(t?"":"text-align-end")},i&&Intl.DateTimeFormat("vi-VN",{hour:"2-digit",minute:"2-digit",day:"2-digit",month:"2-digit",year:"numeric"}).format(new Date(i))))))}function h(e){var t=e.id,a=e.first_name,n=e.last_name,s=e.picture,i=e.message,c=e.created_time,o=t==(0,r.useContext)(m.J).user.id;return r.createElement("div",{className:"ChatBdMessage"},r.createElement("div",{className:"display-flex ".concat(o?"row-reverse":"")},r.createElement("div",{className:"".concat(o?"margin-left-5px":"margin-right-5px")},r.createElement(f,{picture:s})),r.createElement("div",null,r.createElement(g,{is_user:o,message:i,first_name:a,last_name:n,created_time:c}))))}function y(e){var t=e.message_arr,a=e.is_fetching,n=e.handleScrollToGetMessage;return r.createElement("div",{className:"ChatMidBody"},r.createElement("div",{className:"ChatMidBody_row display-flex col-reverse padding-8px",onScroll:n},r.createElement("div",{className:"display-flex col-reverse"},t.map((function(e,t){return r.createElement("div",{key:"".concat(t),className:"ChatMidBody_item"},r.createElement(h,e))}))),r.createElement("div",{className:"text-align-center font-italic ".concat(a?"":"display-none")},"Loading...")))}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function v(e){var t,a,n=e.handleSend,s=(t=(0,r.useState)(""),a=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var r,n,s=[],i=!0,c=!1;try{for(a=a.call(e);!(i=(r=a.next()).done)&&(s.push(r.value),!t||s.length!==t);i=!0);}catch(e){c=!0,n=e}finally{try{i||null==a.return||a.return()}finally{if(c)throw n}}return s}}(t,a)||function(e,t){if(e){if("string"==typeof e)return p(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?p(e,t):void 0}}(t,a)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=s[0],c=s[1],o=(0,r.useRef)(null);return r.createElement("div",{className:"ChatMidFoot padding-8px"},r.createElement("div",{className:"ChatMidFoot_row display-flex align-items-center"},r.createElement("div",null),r.createElement("div",{className:"ChatMidBody_mid flex-grow-1"},r.createElement("textarea",{ref:o,className:"ChatMidFoot_textarea w-100per scroll-thin bg-fb",rows:1,value:i,placeholder:"Write something...",onChange:function(e){c(e.target.value),e.currentTarget.style.height="auto",e.currentTarget.style.height=e.currentTarget.scrollHeight+"px"}})),r.createElement("div",{className:"ChatMidFoot_right margin-left-5px"},r.createElement("div",null,r.createElement("button",{className:"btn btn-hv btn-active brs-5px label-field ".concat(i.trim()?"":"opacity-05"),type:"button",disabled:!i.trim(),onClick:function(){i.trim()&&(n(i),c(""),o.current.style.height="auto")}},"Send")))))}function b(e,t,a,r,n,s,i){try{var c=e[s](i),o=c.value}catch(e){return void a(e)}c.done?t(o):Promise.resolve(o).then(r,n)}function _(e){return function(){var t=this,a=arguments;return new Promise((function(r,n){var s=e.apply(t,a);function i(e){b(s,r,n,i,c,"next",e)}function c(e){b(s,r,n,i,c,"throw",e)}i(void 0)}))}}function E(e){return function(e){if(Array.isArray(e))return C(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||x(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function N(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?w(Object(a),!0).forEach((function(t){S(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):w(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function S(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function x(e,t){if(e){if("string"==typeof e)return C(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?C(e,t):void 0}}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function O(e){var t,a,n=e.ws,s=(t=(0,r.useState)({message_arr:[{id:0,first_name:"",last_name:"",picture:"",message:"",created_time:""}],count:0,has_fetched:!1,is_fetching:!1}),a=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var r,n,s=[],i=!0,c=!1;try{for(a=a.call(e);!(i=(r=a.next()).done)&&(s.push(r.value),!t||s.length!==t);i=!0);}catch(e){c=!0,n=e}finally{try{i||null==a.return||a.return()}finally{if(c)throw n}}return s}}(t,a)||x(t,a)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=s[0],c=s[1],o=i.message_arr,l=i.has_fetched,d=i.is_fetching,m=(0,r.useRef)(!1),f=(0,r.useRef)(!1),g=(0,r.useRef)(0);function h(){return p.apply(this,arguments)}function p(){return(p=_(regeneratorRuntime.mark((function e(){var t,a,r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},e.prev=1,m.current=!0,c(N(N({},i),{},{is_fetching:!0},t)),e.next=6,u({c_count:g.current,size:20});case 6:a=e.sent,c((function(e){return g.current=l?o.length+a.data.data.length:a.data.data.length,f.current=g.current>=a.data.count,{message_arr:l?[].concat(E(o),E(a.data.data)):a.data.data,count:g.current,has_fetched:!0,is_fetching:!1}})),l&&document.getElementsByClassName("ChatMidBody_item")[o.length].scrollIntoView(!1),setTimeout((function(){m.current=!1}),100),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),console.log(e.t0);case 15:case"end":return e.stop()}}),e,null,[[1,12]])})))).apply(this,arguments)}return(0,r.useEffect)((function(){h({message_arr:[],has_fetched:!1})}),[]),(0,r.useEffect)((function(){n.current&&(n.current.onmessage=function(e){console.log(e.data),"message"==JSON.parse(e.data)._type&&(console.log("ok"),function(e){var t=JSON.parse(e.data),a=t.id,r=t.first_name,n=t.last_name,s=t.picture,i=t.message;c((function(e){return N(N({},e),{},{message_arr:[{id:a,first_name:r,last_name:n,picture:s,message:i,created_time:(new Date).toString()}].concat(E(e.message_arr)),count:e.count+1})})),g.current+=1}(e))})}),[n.current]),r.createElement("div",{className:"ChatMid bg-primary"},r.createElement("div",null,r.createElement(y,{message_arr:o,is_fetching:d,handleScrollToGetMessage:function(e){!m.current&&!f.current&&e.currentTarget.scrollTop<=e.currentTarget.clientHeight-e.currentTarget.scrollHeight&&h()}})),r.createElement("div",null,r.createElement(v,{handleSend:function(e){n.current.send(JSON.stringify({_type:"message",message:e}))}})))}function j(e){var t=(0,r.useRef)(null);return(0,r.useEffect)((function(){t.current=new WebSocket("ws://"+location.host+"/ws/chat/world/"),t.current.onopen=function(){console.log("open")},t.current.onclose=function(){console.log("close")}})),r.createElement("div",{className:"Chat position-rel"},r.createElement("div",{className:"display-flex justify-content-center"},r.createElement("div",{className:"Chat_left"}),r.createElement("div",{className:"Chat_mid"},r.createElement(O,{ws:t})),r.createElement("div",{className:"Chat_right"})))}}}]);